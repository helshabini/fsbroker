Running tests...
=== RUN   TestEventQueue
=== RUN   TestEventQueue/Push_and_Pop_single_event
=== RUN   TestEventQueue/Push_and_Pop_multiple_events
=== RUN   TestEventQueue/Pop_from_empty_queue
=== RUN   TestEventQueue/Concurrent_Push_and_List
=== RUN   TestEventQueue/Concurrent_Push_and_Pop
=== RUN   TestEventQueue/List_returns_copy_of_queue
=== RUN   TestEventQueue/Queue_maintains_order_under_concurrent_operations
--- PASS: TestEventQueue (0.00s)
    --- PASS: TestEventQueue/Push_and_Pop_single_event (0.00s)
    --- PASS: TestEventQueue/Push_and_Pop_multiple_events (0.00s)
    --- PASS: TestEventQueue/Pop_from_empty_queue (0.00s)
    --- PASS: TestEventQueue/Concurrent_Push_and_List (0.00s)
    --- PASS: TestEventQueue/Concurrent_Push_and_Pop (0.00s)
    --- PASS: TestEventQueue/List_returns_copy_of_queue (0.00s)
    --- PASS: TestEventQueue/Queue_maintains_order_under_concurrent_operations (0.00s)
=== RUN   TestNewFSEvent
=== RUN   TestNewFSEvent/Basic_event_creation
=== RUN   TestNewFSEvent/Event_with_properties
=== RUN   TestNewFSEvent/Event_with_empty_path
=== RUN   TestNewFSEvent/Event_with_nil_timestamp
--- PASS: TestNewFSEvent (0.00s)
    --- PASS: TestNewFSEvent/Basic_event_creation (0.00s)
    --- PASS: TestNewFSEvent/Event_with_properties (0.00s)
    --- PASS: TestNewFSEvent/Event_with_empty_path (0.00s)
    --- PASS: TestNewFSEvent/Event_with_nil_timestamp (0.00s)
=== RUN   TestEventTypeString
=== RUN   TestEventTypeString/Create
=== RUN   TestEventTypeString/Write
=== RUN   TestEventTypeString/Rename
=== RUN   TestEventTypeString/Remove
=== RUN   TestEventTypeString/Chmod
=== RUN   TestEventTypeString/Unknown
--- PASS: TestEventTypeString (0.00s)
    --- PASS: TestEventTypeString/Create (0.00s)
    --- PASS: TestEventTypeString/Write (0.00s)
    --- PASS: TestEventTypeString/Rename (0.00s)
    --- PASS: TestEventTypeString/Remove (0.00s)
    --- PASS: TestEventTypeString/Chmod (0.00s)
    --- PASS: TestEventTypeString/Unknown (0.00s)
=== RUN   TestFSEventSignature
=== RUN   TestFSEventSignature/Basic_signature
=== RUN   TestFSEventSignature/Signature_with_different_event_types
=== RUN   TestFSEventSignature/Signature_with_different_event_types/0-/test/path
=== RUN   TestFSEventSignature/Signature_with_different_event_types/1-/test/path
=== RUN   TestFSEventSignature/Signature_with_different_event_types/2-/test/path
=== RUN   TestFSEventSignature/Signature_with_different_event_types/3-/test/path
=== RUN   TestFSEventSignature/Signature_with_different_event_types/4-/test/path
=== RUN   TestFSEventSignature/Signature_with_empty_path
=== RUN   TestFSEventSignature/Signature_with_special_characters_in_path
--- PASS: TestFSEventSignature (0.00s)
    --- PASS: TestFSEventSignature/Basic_signature (0.00s)
    --- PASS: TestFSEventSignature/Signature_with_different_event_types (0.00s)
        --- PASS: TestFSEventSignature/Signature_with_different_event_types/0-/test/path (0.00s)
        --- PASS: TestFSEventSignature/Signature_with_different_event_types/1-/test/path (0.00s)
        --- PASS: TestFSEventSignature/Signature_with_different_event_types/2-/test/path (0.00s)
        --- PASS: TestFSEventSignature/Signature_with_different_event_types/3-/test/path (0.00s)
        --- PASS: TestFSEventSignature/Signature_with_different_event_types/4-/test/path (0.00s)
    --- PASS: TestFSEventSignature/Signature_with_empty_path (0.00s)
    --- PASS: TestFSEventSignature/Signature_with_special_characters_in_path (0.00s)
=== RUN   TestFSBrokerIntegration
=== RUN   TestFSBrokerIntegration/CreateEmptyFile
[DEBUG - eventloop] Top of loop. Current queue size: 0
FSNotify Event: CREATE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3088047061/watch/empty_file.txt
[DEBUG - addEvent] Received fsnotify event: Op=CREATE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3088047061/watch/empty_file.txt
[DEBUG - addEvent]   -> Mapped to EventType: Create
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3088047061/watch/empty_file.txt] Create event detected. Attempting immediate stat & map update.
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3088047061/watch/empty_file.txt] Immediate os.Stat successful. Watchmap updated with ID 62372101.
[DEBUG - addEvent] Queuing event: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3088047061/watch/empty_file.txt
[DEBUG - eventloop] Top of loop. Current queue size: 1
[DEBUG] Initial eventList snapshot (Size: 1):
  - 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3088047061/watch/empty_file.txt
[DEBUG] Loop Start: Popped action: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3088047061/watch/empty_file.txt, Sig=0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3088047061/watch/empty_file.txt
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3088047061/watch/empty_file.txt] Entering Create handler
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3088047061/watch/empty_file.txt] os.Stat successful.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3088047061/watch/empty_file.txt] Path /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3088047061/watch/empty_file.txt got info: Id: 62372101, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3088047061/watch/empty_file.txt, Mode: 644
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3088047061/watch/empty_file.txt] Entering Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3088047061/watch/empty_file.txt] Exited Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3088047061/watch/empty_file.txt] Processing as normal Create (not rename/move). isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3088047061/watch/empty_file.txt] Entering Write partner check block.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3088047061/watch/empty_file.txt] Exited Write partner check block. foundWritePartner=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3088047061/watch/empty_file.txt] No write partner found, emitting CREATE.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3088047061/watch/empty_file.txt] Emitting final CREATE event: &{0 /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3088047061/watch/empty_file.txt 2025-04-27 14:10:27.903927 +0300 EEST m=+0.106533251 map[]}
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3088047061/watch/empty_file.txt] Exiting Create handler.
[DEBUG] Loop End: Final processed paths: map[0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3088047061/watch/empty_file.txt:true]
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:153: Received expected event: Type=0, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3088047061/watch/empty_file.txt, Props=map[Id:62372101 ModTime:2025-04-27 14:10:27.903106855 +0300 EEST Mode:420 Size:0]
=== RUN   TestFSBrokerIntegration/CreateNonEmptyFile
[DEBUG - eventloop] Top of loop. Current queue size: 0
FSNotify Event: CREATE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1861105524/watch/non_empty_file.txt
[DEBUG - addEvent] Received fsnotify event: Op=CREATE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1861105524/watch/non_empty_file.txt
[DEBUG - addEvent]   -> Mapped to EventType: Create
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1861105524/watch/non_empty_file.txt] Create event detected. Attempting immediate stat & map update.
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1861105524/watch/non_empty_file.txt] Immediate os.Stat successful. Watchmap updated with ID 62372104.
[DEBUG - addEvent] Queuing event: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1861105524/watch/non_empty_file.txt
[DEBUG - eventloop] Top of loop. Current queue size: 1
[DEBUG] Initial eventList snapshot (Size: 1):
  - 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1861105524/watch/non_empty_file.txt
[DEBUG] Loop Start: Popped action: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1861105524/watch/non_empty_file.txt, Sig=0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1861105524/watch/non_empty_file.txt
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1861105524/watch/non_empty_file.txt] Entering Create handler
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1861105524/watch/non_empty_file.txt] os.Stat successful.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1861105524/watch/non_empty_file.txt] Path /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1861105524/watch/non_empty_file.txt got info: Id: 62372104, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1861105524/watch/non_empty_file.txt, Mode: 644
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1861105524/watch/non_empty_file.txt] Entering Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1861105524/watch/non_empty_file.txt] Exited Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1861105524/watch/non_empty_file.txt] Processing as normal Create (not rename/move). isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1861105524/watch/non_empty_file.txt] Entering Write partner check block.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1861105524/watch/non_empty_file.txt] Exited Write partner check block. foundWritePartner=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1861105524/watch/non_empty_file.txt] No write partner found, emitting CREATE.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1861105524/watch/non_empty_file.txt] Emitting final CREATE event: &{0 /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1861105524/watch/non_empty_file.txt 2025-04-27 14:10:28.407269 +0300 EEST m=+0.609873417 map[]}
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1861105524/watch/non_empty_file.txt] Exiting Create handler.
[DEBUG] Loop End: Final processed paths: map[0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1861105524/watch/non_empty_file.txt:true]
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:166: Received expected event: Type=0, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1861105524/watch/non_empty_file.txt, Props=map[Id:62372104 ModTime:2025-04-27 14:10:28.406939997 +0300 EEST Mode:420 Size:7]
    fsbroker_test.go:170: Correctly received no event or error within 200ms
=== RUN   TestFSBrokerIntegration/ModifyFile
[DEBUG - eventloop] Top of loop. Current queue size: 0
FSNotify Event: CREATE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3209791778/watch/modify_file.txt
[DEBUG - addEvent] Received fsnotify event: Op=CREATE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3209791778/watch/modify_file.txt
[DEBUG - addEvent]   -> Mapped to EventType: Create
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3209791778/watch/modify_file.txt] Create event detected. Attempting immediate stat & map update.
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3209791778/watch/modify_file.txt] Immediate os.Stat successful. Watchmap updated with ID 62372108.
[DEBUG - addEvent] Queuing event: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3209791778/watch/modify_file.txt
[DEBUG - eventloop] Top of loop. Current queue size: 1
[DEBUG] Initial eventList snapshot (Size: 1):
  - 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3209791778/watch/modify_file.txt
[DEBUG] Loop Start: Popped action: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3209791778/watch/modify_file.txt, Sig=0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3209791778/watch/modify_file.txt
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3209791778/watch/modify_file.txt] Entering Create handler
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3209791778/watch/modify_file.txt] os.Stat successful.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3209791778/watch/modify_file.txt] Path /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3209791778/watch/modify_file.txt got info: Id: 62372108, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3209791778/watch/modify_file.txt, Mode: 644
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3209791778/watch/modify_file.txt] Entering Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3209791778/watch/modify_file.txt] Exited Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3209791778/watch/modify_file.txt] Processing as normal Create (not rename/move). isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3209791778/watch/modify_file.txt] Entering Write partner check block.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3209791778/watch/modify_file.txt] Exited Write partner check block. foundWritePartner=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3209791778/watch/modify_file.txt] No write partner found, emitting CREATE.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3209791778/watch/modify_file.txt] Emitting final CREATE event: &{0 /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3209791778/watch/modify_file.txt 2025-04-27 14:10:29.11519 +0300 EEST m=+1.317791959 map[]}
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3209791778/watch/modify_file.txt] Exiting Create handler.
[DEBUG] Loop End: Final processed paths: map[0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3209791778/watch/modify_file.txt:true]
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:182: Received expected event: Type=0, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3209791778/watch/modify_file.txt, Props=map[Id:62372108 ModTime:2025-04-27 14:10:29.115037188 +0300 EEST Mode:420 Size:7]
FSNotify Event: WRITE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3209791778/watch/modify_file.txt
[DEBUG - addEvent] Received fsnotify event: Op=WRITE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3209791778/watch/modify_file.txt
[DEBUG - addEvent]   -> Mapped to EventType: Write
[DEBUG - addEvent] Queuing event: Type=Write, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3209791778/watch/modify_file.txt
[DEBUG - eventloop] Top of loop. Current queue size: 1
[DEBUG] Initial eventList snapshot (Size: 1):
  - 1-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3209791778/watch/modify_file.txt
[DEBUG] Loop Start: Popped action: Type=Write, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3209791778/watch/modify_file.txt, Sig=1-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3209791778/watch/modify_file.txt
[DEBUG - Write] No preceding Create found or Create already processed. Emitting WRITE event: &{1 /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3209791778/watch/modify_file.txt 2025-04-27 14:10:29.41446 +0300 EEST m=+1.617061501 map[]}
[DEBUG - Write 1-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3209791778/watch/modify_file.txt] Watchmap state before Set/Enrich/Emit:
Watchmap size: 1
/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3209791778/watch/modify_file.txt Id: 62372108, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3209791778/watch/modify_file.txt, Mode: 644
[DEBUG] Loop End: Final processed paths: map[1-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3209791778/watch/modify_file.txt:true]
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:196: Received expected event: Type=1, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3209791778/watch/modify_file.txt, Props=map[Id:62372108 ModTime:2025-04-27 14:10:29.414359115 +0300 EEST Mode:420 Size:16]
=== RUN   TestFSBrokerIntegration/ClearFile
[DEBUG - eventloop] Top of loop. Current queue size: 0
FSNotify Event: CREATE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1885453159/watch/clear_file.txt
[DEBUG - addEvent] Received fsnotify event: Op=CREATE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1885453159/watch/clear_file.txt
[DEBUG - addEvent]   -> Mapped to EventType: Create
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1885453159/watch/clear_file.txt] Create event detected. Attempting immediate stat & map update.
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1885453159/watch/clear_file.txt] Immediate os.Stat successful. Watchmap updated with ID 62372111.
[DEBUG - addEvent] Queuing event: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1885453159/watch/clear_file.txt
[DEBUG - eventloop] Top of loop. Current queue size: 1
[DEBUG] Initial eventList snapshot (Size: 1):
  - 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1885453159/watch/clear_file.txt
[DEBUG] Loop Start: Popped action: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1885453159/watch/clear_file.txt, Sig=0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1885453159/watch/clear_file.txt
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1885453159/watch/clear_file.txt] Entering Create handler
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1885453159/watch/clear_file.txt] os.Stat successful.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1885453159/watch/clear_file.txt] Path /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1885453159/watch/clear_file.txt got info: Id: 62372111, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1885453159/watch/clear_file.txt, Mode: 644
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1885453159/watch/clear_file.txt] Entering Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1885453159/watch/clear_file.txt] Exited Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1885453159/watch/clear_file.txt] Processing as normal Create (not rename/move). isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1885453159/watch/clear_file.txt] Entering Write partner check block.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1885453159/watch/clear_file.txt] Exited Write partner check block. foundWritePartner=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1885453159/watch/clear_file.txt] No write partner found, emitting CREATE.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1885453159/watch/clear_file.txt] Emitting final CREATE event: &{0 /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1885453159/watch/clear_file.txt 2025-04-27 14:10:30.021638 +0300 EEST m=+2.224237126 map[]}
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1885453159/watch/clear_file.txt] Exiting Create handler.
[DEBUG] Loop End: Final processed paths: map[0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1885453159/watch/clear_file.txt:true]
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:209: Received expected event: Type=0, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1885453159/watch/clear_file.txt, Props=map[Id:62372111 ModTime:2025-04-27 14:10:30.021370243 +0300 EEST Mode:420 Size:9]
FSNotify Event: CHMOD, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1885453159/watch/clear_file.txt
[DEBUG - addEvent] Received fsnotify event: Op=CHMOD, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1885453159/watch/clear_file.txt
[DEBUG - addEvent]   -> Mapped to EventType: Chmod
[DEBUG - addEvent] Queuing event: Type=Chmod, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1885453159/watch/clear_file.txt
[DEBUG - eventloop] Top of loop. Current queue size: 1
[DEBUG] Initial eventList snapshot (Size: 1):
  - 4-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1885453159/watch/clear_file.txt
[DEBUG] Loop Start: Popped action: Type=Chmod, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1885453159/watch/clear_file.txt, Sig=4-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1885453159/watch/clear_file.txt
[DEBUG] Loop End: Final processed paths: map[4-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1885453159/watch/clear_file.txt:true]
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:216: Received expected event: Type=1, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1885453159/watch/clear_file.txt, Props=map[Id:62372111 ModTime:2025-04-27 14:10:30.321558214 +0300 EEST Mode:420 Size:0]
=== RUN   TestFSBrokerIntegration/RenameFileInplace
[DEBUG - eventloop] Top of loop. Current queue size: 0
FSNotify Event: CREATE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt
[DEBUG - addEvent] Received fsnotify event: Op=CREATE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt
[DEBUG - addEvent]   -> Mapped to EventType: Create
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt] Create event detected. Attempting immediate stat & map update.
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt] Immediate os.Stat successful. Watchmap updated with ID 62372118.
[DEBUG - addEvent] Queuing event: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt
[DEBUG - eventloop] Top of loop. Current queue size: 1
[DEBUG] Initial eventList snapshot (Size: 1):
  - 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt
[DEBUG] Loop Start: Popped action: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt, Sig=0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt] Entering Create handler
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt] os.Stat successful.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt] Path /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt got info: Id: 62372118, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt, Mode: 644
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt] Entering Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt] Exited Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt] Processing as normal Create (not rename/move). isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt] Entering Write partner check block.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt] Exited Write partner check block. foundWritePartner=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt] No write partner found, emitting CREATE.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt] Emitting final CREATE event: &{0 /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt 2025-04-27 14:10:30.924973 +0300 EEST m=+3.127569792 map[]}
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt] Exiting Create handler.
[DEBUG] Loop End: Final processed paths: map[0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt:true]
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:230: Received expected event: Type=0, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt, Props=map[Id:62372118 ModTime:2025-04-27 14:10:30.924810456 +0300 EEST Mode:420 Size:7]
FSNotify Event: CREATE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/new_name.txt
[DEBUG - addEvent] Received fsnotify event: Op=CREATE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/new_name.txt
[DEBUG - addEvent]   -> Mapped to EventType: Create
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/new_name.txt] Create event detected. Attempting immediate stat & map update.
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/new_name.txt] Immediate os.Stat successful. Watchmap updated with ID 62372118.
[DEBUG - addEvent] Queuing event: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/new_name.txt
[DEBUG - eventloop] Top of loop. Current queue size: 1
FSNotify Event: RENAME, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt
[DEBUG - addEvent] Received fsnotify event: Op=RENAME, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt
[DEBUG - addEvent]   -> Mapped to EventType: Rename
[DEBUG - addEvent] Queuing event: Type=Rename, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt
[DEBUG - eventloop] Top of loop. Current queue size: 2
[DEBUG] Initial eventList snapshot (Size: 2):
  - 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/new_name.txt
  - 2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt
[DEBUG] Loop Start: Popped action: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/new_name.txt, Sig=0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/new_name.txt
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/new_name.txt] Entering Create handler
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/new_name.txt] os.Stat successful.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/new_name.txt] Path /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/new_name.txt got info: Id: 62372118, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/new_name.txt, Mode: 644
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/new_name.txt] Entering Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/new_name.txt] Checking potential RENAME partner: 2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt
Watchmap size: 2
/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/new_name.txt Id: 62372118, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/new_name.txt, Mode: 644
/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt Id: 62372118, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt, Mode: 644
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/new_name.txt] Info for potential old path /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt from watchmap: Id: 62372118, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt, Mode: 644
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/new_name.txt] Comparing IDs: potentialRename.Id (62372118) == info.Id (62372118) -> true
[DEBUG - Create] Found RENAME partner 2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt for CREATE 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/new_name.txt via ID match (62372118). Synthesizing.
[DEBUG - Create] Emitting synthesized RENAME: &{2 /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/new_name.txt 2025-04-27 14:10:31.225374 +0300 EEST m=+3.427969959 map[Id:62372118 ModTime:2025-04-27 14:10:30.924810456 +0300 EEST Mode:420 OldPath:/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt Size:7]}
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/new_name.txt] Updating watchmap: Deleting /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt, Setting /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/new_name.txt
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/new_name.txt] Exited Rename check block. isRenameOrMove=true
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/new_name.txt] Exiting Create handler.
[DEBUG] Loop Start: Popped action: Type=Rename, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt, Sig=2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt
[DEBUG] Loop Skip: Action 2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt already processed.
[DEBUG] Loop End: Final processed paths: map[0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/new_name.txt:true 2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt:true]
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:237: Received expected event: Type=2, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/new_name.txt, Props=map[Id:62372118 ModTime:2025-04-27 14:10:30.924810456 +0300 EEST Mode:420 OldPath:/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_472948026/watch/old_name.txt Size:7]
=== RUN   TestFSBrokerIntegration/MoveFileWatchedToWatched
[DEBUG - eventloop] Top of loop. Current queue size: 0
FSNotify Event: CREATE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir
[DEBUG - addEvent] Received fsnotify event: Op=CREATE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir
[DEBUG - addEvent]   -> Mapped to EventType: Create
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir] Create event detected. Attempting immediate stat & map update.
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir] Immediate os.Stat successful. Watchmap updated with ID 62372138.
[DEBUG - addEvent] Queuing event: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir
[DEBUG - eventloop] Top of loop. Current queue size: 1
[DEBUG] Initial eventList snapshot (Size: 1):
  - 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir
[DEBUG] Loop Start: Popped action: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir, Sig=0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir] Entering Create handler
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir] os.Stat successful.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir] Path /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir got info: Id: 62372138, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir, Mode: 20000000755
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir] Entering Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir] Exited Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir] Processing as normal Create (not rename/move). isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir] Emitting final CREATE event: &{0 /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir 2025-04-27 14:10:31.828474 +0300 EEST m=+4.031067501 map[]}
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir] Exiting Create handler.
[DEBUG] Loop End: Final processed paths: map[0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir:true]
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:253: Received expected event: Type=0, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir, Props=map[Id:62372138 ModTime:2025-04-27 14:10:31.828092458 +0300 EEST Mode:2147484141 Size:64]
FSNotify Event: CREATE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt
[DEBUG - addEvent] Received fsnotify event: Op=CREATE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt
[DEBUG - addEvent]   -> Mapped to EventType: Create
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt] Create event detected. Attempting immediate stat & map update.
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt] Immediate os.Stat successful. Watchmap updated with ID 62372140.
[DEBUG - addEvent] Queuing event: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt
[DEBUG - eventloop] Top of loop. Current queue size: 1
[DEBUG] Initial eventList snapshot (Size: 1):
  - 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt
[DEBUG] Loop Start: Popped action: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt, Sig=0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt] Entering Create handler
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt] os.Stat successful.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt] Path /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt got info: Id: 62372140, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt, Mode: 644
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt] Entering Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt] Exited Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt] Processing as normal Create (not rename/move). isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt] Entering Write partner check block.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt] Exited Write partner check block. foundWritePartner=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt] No write partner found, emitting CREATE.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt] Emitting final CREATE event: &{0 /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt 2025-04-27 14:10:32.329445 +0300 EEST m=+4.532037376 map[]}
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt] Exiting Create handler.
[DEBUG] Loop End: Final processed paths: map[0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt:true]
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:264: Received expected event: Type=0, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt, Props=map[Id:62372140 ModTime:2025-04-27 14:10:32.3293683 +0300 EEST Mode:420 Size:7]
FSNotify Event: CREATE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir/move_me.txt
[DEBUG - addEvent] Received fsnotify event: Op=CREATE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir/move_me.txt
[DEBUG - addEvent]   -> Mapped to EventType: Create
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir/move_me.txt] Create event detected. Attempting immediate stat & map update.
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir/move_me.txt] Immediate os.Stat successful. Watchmap updated with ID 62372140.
[DEBUG - addEvent] Queuing event: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir/move_me.txt
[DEBUG - eventloop] Top of loop. Current queue size: 1
FSNotify Event: RENAME, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt
[DEBUG - addEvent] Received fsnotify event: Op=RENAME, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt
[DEBUG - addEvent]   -> Mapped to EventType: Rename
[DEBUG - addEvent] Queuing event: Type=Rename, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt
[DEBUG - eventloop] Top of loop. Current queue size: 2
[DEBUG] Initial eventList snapshot (Size: 2):
  - 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir/move_me.txt
  - 2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt
[DEBUG] Loop Start: Popped action: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir/move_me.txt, Sig=0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir/move_me.txt
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir/move_me.txt] Entering Create handler
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir/move_me.txt] os.Stat successful.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir/move_me.txt] Path /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir/move_me.txt got info: Id: 62372140, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir/move_me.txt, Mode: 644
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir/move_me.txt] Entering Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir/move_me.txt] Checking potential RENAME partner: 2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt
Watchmap size: 3
/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt Id: 62372140, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt, Mode: 644
/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir/move_me.txt Id: 62372140, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir/move_me.txt, Mode: 644
/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir Id: 62372138, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir, Mode: 20000000755
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir/move_me.txt] Info for potential old path /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt from watchmap: Id: 62372140, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt, Mode: 644
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir/move_me.txt] Comparing IDs: potentialRename.Id (62372140) == info.Id (62372140) -> true
[DEBUG - Create] Found RENAME partner 2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt for CREATE 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir/move_me.txt via ID match (62372140). Synthesizing.
[DEBUG - Create] Emitting synthesized RENAME: &{2 /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir/move_me.txt 2025-04-27 14:10:32.529393 +0300 EEST m=+4.731984459 map[Id:62372140 ModTime:2025-04-27 14:10:32.3293683 +0300 EEST Mode:420 OldPath:/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt Size:7]}
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir/move_me.txt] Updating watchmap: Deleting /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt, Setting /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir/move_me.txt
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir/move_me.txt] Exited Rename check block. isRenameOrMove=true
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir/move_me.txt] Exiting Create handler.
[DEBUG] Loop Start: Popped action: Type=Rename, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt, Sig=2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt
[DEBUG] Loop Skip: Action 2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt already processed.
[DEBUG] Loop End: Final processed paths: map[0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir/move_me.txt:true 2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt:true]
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:271: Received expected event: Type=2, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/subdir/move_me.txt, Props=map[Id:62372140 ModTime:2025-04-27 14:10:32.3293683 +0300 EEST Mode:420 OldPath:/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2693185958/watch/move_me.txt Size:7]
=== RUN   TestFSBrokerIntegration/MoveFileUnwatchedToWatched
[DEBUG - eventloop] Top of loop. Current queue size: 0
FSNotify Event: CREATE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1160779972/watch/external.txt
[DEBUG - addEvent] Received fsnotify event: Op=CREATE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1160779972/watch/external.txt
[DEBUG - addEvent]   -> Mapped to EventType: Create
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1160779972/watch/external.txt] Create event detected. Attempting immediate stat & map update.
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1160779972/watch/external.txt] Immediate os.Stat successful. Watchmap updated with ID 62372143.
[DEBUG - addEvent] Queuing event: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1160779972/watch/external.txt
[DEBUG - eventloop] Top of loop. Current queue size: 1
[DEBUG] Initial eventList snapshot (Size: 1):
  - 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1160779972/watch/external.txt
[DEBUG] Loop Start: Popped action: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1160779972/watch/external.txt, Sig=0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1160779972/watch/external.txt
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1160779972/watch/external.txt] Entering Create handler
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1160779972/watch/external.txt] os.Stat successful.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1160779972/watch/external.txt] Path /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1160779972/watch/external.txt got info: Id: 62372143, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1160779972/watch/external.txt, Mode: 644
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1160779972/watch/external.txt] Entering Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1160779972/watch/external.txt] Exited Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1160779972/watch/external.txt] Processing as normal Create (not rename/move). isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1160779972/watch/external.txt] Entering Write partner check block.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1160779972/watch/external.txt] Exited Write partner check block. foundWritePartner=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1160779972/watch/external.txt] No write partner found, emitting CREATE.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1160779972/watch/external.txt] Emitting final CREATE event: &{0 /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1160779972/watch/external.txt 2025-04-27 14:10:33.132382 +0300 EEST m=+5.334971709 map[]}
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1160779972/watch/external.txt] Exiting Create handler.
[DEBUG] Loop End: Final processed paths: map[0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1160779972/watch/external.txt:true]
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:296: Received expected event: Type=0, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1160779972/watch/external.txt, Props=map[Id:62372143 ModTime:2025-04-27 14:10:33.131863034 +0300 EEST Mode:420 Size:16]
=== RUN   TestFSBrokerIntegration/MoveFileWatchedToUnwatched
[DEBUG - eventloop] Top of loop. Current queue size: 0
FSNotify Event: CREATE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt
[DEBUG - addEvent] Received fsnotify event: Op=CREATE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt
[DEBUG - addEvent]   -> Mapped to EventType: Create
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt] Create event detected. Attempting immediate stat & map update.
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt] Immediate os.Stat successful. Watchmap updated with ID 62372146.
[DEBUG - addEvent] Queuing event: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt
[DEBUG - eventloop] Top of loop. Current queue size: 1
[DEBUG] Initial eventList snapshot (Size: 1):
  - 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt
[DEBUG] Loop Start: Popped action: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt, Sig=0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt] Entering Create handler
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt] os.Stat successful.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt] Path /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt got info: Id: 62372146, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt, Mode: 644
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt] Entering Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt] Exited Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt] Processing as normal Create (not rename/move). isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt] Entering Write partner check block.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt] Exited Write partner check block. foundWritePartner=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt] No write partner found, emitting CREATE.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt] Emitting final CREATE event: &{0 /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt 2025-04-27 14:10:33.635642 +0300 EEST m=+5.838230167 map[]}
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt] Exiting Create handler.
[DEBUG] Loop End: Final processed paths: map[0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt:true]
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:311: Received expected event: Type=0, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt, Props=map[Id:62372146 ModTime:2025-04-27 14:10:33.635567216 +0300 EEST Mode:420 Size:16]
FSNotify Event: RENAME, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt
[DEBUG - addEvent] Received fsnotify event: Op=RENAME, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt
[DEBUG - addEvent]   -> Mapped to EventType: Rename
[DEBUG - addEvent] Queuing event: Type=Rename, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt
[DEBUG - eventloop] Top of loop. Current queue size: 1
[DEBUG] Initial eventList snapshot (Size: 1):
  - 2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt
[DEBUG] Loop Start: Popped action: Type=Rename, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt, Sig=2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt
[DEBUG - Rename 2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt] Processing. Dumping watchmap BEFORE Get:
Watchmap size: 1
/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt Id: 62372146, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt, Mode: 644
[DEBUG - Rename] No CREATE partner found for RENAME 2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt. Synthesizing Remove.
[DEBUG - Rename 2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt] Watchmap state before potential delete of /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt:
Watchmap size: 1
/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt Id: 62372146, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt, Mode: 644
[DEBUG - Rename] Emitting synthesized REMOVE: &{3 /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt 2025-04-27 14:10:34.137688 +0300 EEST m=+6.340275042 map[Id:62372146 ModTime:2025-04-27 14:10:33.635567216 +0300 EEST Mode:420 Size:16 Type:Soft]}
[DEBUG] Loop End: Final processed paths: map[2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt:true]
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:320: Received expected event: Type=3, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1379213067/watch/internal.txt, Props=map[Id:62372146 ModTime:2025-04-27 14:10:33.635567216 +0300 EEST Mode:420 Size:16 Type:Soft]
=== RUN   TestFSBrokerIntegration/HardDeleteFile
[DEBUG - eventloop] Top of loop. Current queue size: 0
FSNotify Event: CREATE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3857110640/watch/delete_me.txt
[DEBUG - addEvent] Received fsnotify event: Op=CREATE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3857110640/watch/delete_me.txt
[DEBUG - addEvent]   -> Mapped to EventType: Create
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3857110640/watch/delete_me.txt] Create event detected. Attempting immediate stat & map update.
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3857110640/watch/delete_me.txt] Immediate os.Stat successful. Watchmap updated with ID 62372149.
[DEBUG - addEvent] Queuing event: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3857110640/watch/delete_me.txt
[DEBUG - eventloop] Top of loop. Current queue size: 1
[DEBUG] Initial eventList snapshot (Size: 1):
  - 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3857110640/watch/delete_me.txt
[DEBUG] Loop Start: Popped action: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3857110640/watch/delete_me.txt, Sig=0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3857110640/watch/delete_me.txt
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3857110640/watch/delete_me.txt] Entering Create handler
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3857110640/watch/delete_me.txt] os.Stat successful.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3857110640/watch/delete_me.txt] Path /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3857110640/watch/delete_me.txt got info: Id: 62372149, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3857110640/watch/delete_me.txt, Mode: 644
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3857110640/watch/delete_me.txt] Entering Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3857110640/watch/delete_me.txt] Exited Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3857110640/watch/delete_me.txt] Processing as normal Create (not rename/move). isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3857110640/watch/delete_me.txt] Entering Write partner check block.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3857110640/watch/delete_me.txt] Exited Write partner check block. foundWritePartner=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3857110640/watch/delete_me.txt] No write partner found, emitting CREATE.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3857110640/watch/delete_me.txt] Emitting final CREATE event: &{0 /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3857110640/watch/delete_me.txt 2025-04-27 14:10:34.540898 +0300 EEST m=+6.743482917 map[]}
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3857110640/watch/delete_me.txt] Exiting Create handler.
[DEBUG] Loop End: Final processed paths: map[0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3857110640/watch/delete_me.txt:true]
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:332: Received expected event: Type=0, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3857110640/watch/delete_me.txt, Props=map[Id:62372149 ModTime:2025-04-27 14:10:34.540852768 +0300 EEST Mode:420 Size:13]
FSNotify Event: REMOVE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3857110640/watch/delete_me.txt
[DEBUG - addEvent] Received fsnotify event: Op=REMOVE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3857110640/watch/delete_me.txt
[DEBUG - addEvent]   -> Mapped to EventType: Remove
[DEBUG - addEvent] Queuing event: Type=Remove, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3857110640/watch/delete_me.txt
[DEBUG - eventloop] Top of loop. Current queue size: 1
[DEBUG] Initial eventList snapshot (Size: 1):
  - 3-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3857110640/watch/delete_me.txt
[DEBUG] Loop Start: Popped action: Type=Remove, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3857110640/watch/delete_me.txt, Sig=3-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3857110640/watch/delete_me.txt
[DEBUG] Loop End: Final processed paths: map[3-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3857110640/watch/delete_me.txt:true]
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:339: Received expected event: Type=3, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3857110640/watch/delete_me.txt, Props=map[Id:62372149 ModTime:2025-04-27 14:10:34.540852768 +0300 EEST Mode:420 Size:13 Type:Hard]
=== RUN   TestFSBrokerIntegration/CreateDirectory
[DEBUG - eventloop] Top of loop. Current queue size: 0
FSNotify Event: CREATE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2728457396/watch/new_dir
[DEBUG - addEvent] Received fsnotify event: Op=CREATE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2728457396/watch/new_dir
[DEBUG - addEvent]   -> Mapped to EventType: Create
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2728457396/watch/new_dir] Create event detected. Attempting immediate stat & map update.
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2728457396/watch/new_dir] Immediate os.Stat successful. Watchmap updated with ID 62372152.
[DEBUG - addEvent] Queuing event: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2728457396/watch/new_dir
[DEBUG - eventloop] Top of loop. Current queue size: 1
[DEBUG] Initial eventList snapshot (Size: 1):
  - 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2728457396/watch/new_dir
[DEBUG] Loop Start: Popped action: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2728457396/watch/new_dir, Sig=0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2728457396/watch/new_dir
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2728457396/watch/new_dir] Entering Create handler
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2728457396/watch/new_dir] os.Stat successful.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2728457396/watch/new_dir] Path /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2728457396/watch/new_dir got info: Id: 62372152, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2728457396/watch/new_dir, Mode: 20000000755
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2728457396/watch/new_dir] Entering Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2728457396/watch/new_dir] Exited Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2728457396/watch/new_dir] Processing as normal Create (not rename/move). isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2728457396/watch/new_dir] Emitting final CREATE event: &{0 /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2728457396/watch/new_dir 2025-04-27 14:10:35.445914 +0300 EEST m=+7.648496792 map[]}
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2728457396/watch/new_dir] Exiting Create handler.
[DEBUG] Loop End: Final processed paths: map[0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2728457396/watch/new_dir:true]
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:354: Received expected event: Type=0, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2728457396/watch/new_dir, Props=map[Id:62372152 ModTime:2025-04-27 14:10:35.445474192 +0300 EEST Mode:2147484141 Size:64]
=== RUN   TestFSBrokerIntegration/RenameDirectoryInplace
[DEBUG - eventloop] Top of loop. Current queue size: 0
FSNotify Event: CREATE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir
[DEBUG - addEvent] Received fsnotify event: Op=CREATE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir
[DEBUG - addEvent]   -> Mapped to EventType: Create
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir] Create event detected. Attempting immediate stat & map update.
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir] Immediate os.Stat successful. Watchmap updated with ID 62372155.
[DEBUG - addEvent] Queuing event: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir
[DEBUG - eventloop] Top of loop. Current queue size: 1
[DEBUG] Initial eventList snapshot (Size: 1):
  - 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir
[DEBUG] Loop Start: Popped action: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir, Sig=0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir] Entering Create handler
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir] os.Stat successful.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir] Path /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir got info: Id: 62372155, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir, Mode: 20000000755
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir] Entering Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir] Exited Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir] Processing as normal Create (not rename/move). isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir] Emitting final CREATE event: &{0 /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir 2025-04-27 14:10:35.952373 +0300 EEST m=+8.154953751 map[]}
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir] Exiting Create handler.
[DEBUG] Loop End: Final processed paths: map[0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir:true]
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:368: Received expected event: Type=0, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir, Props=map[Id:62372155 ModTime:2025-04-27 14:10:35.951389465 +0300 EEST Mode:2147484141 Size:64]
FSNotify Event: CREATE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/new_dir
[DEBUG - addEvent] Received fsnotify event: Op=CREATE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/new_dir
[DEBUG - addEvent]   -> Mapped to EventType: Create
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/new_dir] Create event detected. Attempting immediate stat & map update.
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/new_dir] Immediate os.Stat successful. Watchmap updated with ID 62372155.
[DEBUG - addEvent] Queuing event: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/new_dir
FSNotify Event: RENAME, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir
[DEBUG - addEvent] Received fsnotify event: Op=RENAME, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir
[DEBUG - addEvent]   -> Mapped to EventType: Rename
[DEBUG - addEvent] Queuing event: Type=Rename, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir
[DEBUG - eventloop] Top of loop. Current queue size: 1
[DEBUG - eventloop] Top of loop. Current queue size: 2
[DEBUG] Initial eventList snapshot (Size: 2):
  - 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/new_dir
  - 2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir
[DEBUG] Loop Start: Popped action: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/new_dir, Sig=0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/new_dir
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/new_dir] Entering Create handler
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/new_dir] os.Stat successful.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/new_dir] Path /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/new_dir got info: Id: 62372155, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/new_dir, Mode: 20000000755
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/new_dir] Entering Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/new_dir] Checking potential RENAME partner: 2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir
Watchmap size: 2
/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir Id: 62372155, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir, Mode: 20000000755
/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/new_dir Id: 62372155, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/new_dir, Mode: 20000000755
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/new_dir] Info for potential old path /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir from watchmap: Id: 62372155, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir, Mode: 20000000755
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/new_dir] Comparing IDs: potentialRename.Id (62372155) == info.Id (62372155) -> true
[DEBUG - Create] Found RENAME partner 2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir for CREATE 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/new_dir via ID match (62372155). Synthesizing.
[DEBUG - Create] Emitting synthesized RENAME: &{2 /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/new_dir 2025-04-27 14:10:36.252351 +0300 EEST m=+8.454931084 map[Id:62372155 ModTime:2025-04-27 14:10:35.951389465 +0300 EEST Mode:2147484141 OldPath:/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir Size:64]}
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/new_dir] Updating watchmap: Deleting /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir, Setting /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/new_dir
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/new_dir] Exited Rename check block. isRenameOrMove=true
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/new_dir] Exiting Create handler.
[DEBUG] Loop Start: Popped action: Type=Rename, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir, Sig=2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir
[DEBUG] Loop Skip: Action 2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir already processed.
[DEBUG] Loop End: Final processed paths: map[0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/new_dir:true 2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir:true]
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:375: Received expected event: Type=2, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/new_dir, Props=map[Id:62372155 ModTime:2025-04-27 14:10:35.951389465 +0300 EEST Mode:2147484141 OldPath:/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2179319040/watch/old_dir Size:64]
=== RUN   TestFSBrokerIntegration/MoveDirectoryWatchedToWatched
[DEBUG - eventloop] Top of loop. Current queue size: 0
FSNotify Event: CREATE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir
[DEBUG - addEvent] Received fsnotify event: Op=CREATE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir
[DEBUG - addEvent]   -> Mapped to EventType: Create
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir] Create event detected. Attempting immediate stat & map update.
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir] Immediate os.Stat successful. Watchmap updated with ID 62372158.
[DEBUG - addEvent] Queuing event: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir
[DEBUG - eventloop] Top of loop. Current queue size: 1
[DEBUG] Initial eventList snapshot (Size: 1):
  - 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir
[DEBUG] Loop Start: Popped action: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir, Sig=0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir] Entering Create handler
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir] os.Stat successful.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir] Path /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir got info: Id: 62372158, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir, Mode: 20000000755
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir] Entering Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir] Exited Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir] Processing as normal Create (not rename/move). isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir] Emitting final CREATE event: &{0 /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir 2025-04-27 14:10:36.857187 +0300 EEST m=+9.059765376 map[]}
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir] Exiting Create handler.
[DEBUG] Loop End: Final processed paths: map[0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir:true]
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:391: Received expected event: Type=0, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir, Props=map[Id:62372158 ModTime:2025-04-27 14:10:36.856345182 +0300 EEST Mode:2147484141 Size:64]
FSNotify Event: CREATE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir
[DEBUG - addEvent] Received fsnotify event: Op=CREATE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir
[DEBUG - addEvent]   -> Mapped to EventType: Create
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir] Create event detected. Attempting immediate stat & map update.
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir] Immediate os.Stat successful. Watchmap updated with ID 62372159.
[DEBUG - addEvent] Queuing event: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir
[DEBUG - eventloop] Top of loop. Current queue size: 1
[DEBUG] Initial eventList snapshot (Size: 1):
  - 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir
[DEBUG] Loop Start: Popped action: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir, Sig=0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir] Entering Create handler
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir] os.Stat successful.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir] Path /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir got info: Id: 62372159, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir, Mode: 20000000755
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir] Entering Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir] Exited Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir] Processing as normal Create (not rename/move). isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir] Emitting final CREATE event: &{0 /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir 2025-04-27 14:10:37.161312 +0300 EEST m=+9.363889584 map[]}
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir] Exiting Create handler.
[DEBUG] Loop End: Final processed paths: map[0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir:true]
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:400: Received expected event: Type=0, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir, Props=map[Id:62372159 ModTime:2025-04-27 14:10:37.157858407 +0300 EEST Mode:2147484141 Size:64]
FSNotify Event: CREATE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir/move_this_dir
[DEBUG - addEvent] Received fsnotify event: Op=CREATE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir/move_this_dir
[DEBUG - addEvent]   -> Mapped to EventType: Create
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir/move_this_dir] Create event detected. Attempting immediate stat & map update.
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir/move_this_dir] Immediate os.Stat successful. Watchmap updated with ID 62372159.
[DEBUG - addEvent] Queuing event: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir/move_this_dir
FSNotify Event: RENAME, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir
[DEBUG - addEvent] Received fsnotify event: Op=RENAME, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir
[DEBUG - addEvent]   -> Mapped to EventType: Rename
[DEBUG - addEvent] Queuing event: Type=Rename, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir
[DEBUG - eventloop] Top of loop. Current queue size: 1
[DEBUG - eventloop] Top of loop. Current queue size: 2
FSNotify Event: RENAME, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir
[DEBUG - addEvent] Received fsnotify event: Op=RENAME, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir
[DEBUG - addEvent]   -> Mapped to EventType: Rename
[DEBUG - addEvent] Queuing event: Type=Rename, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir
[DEBUG - eventloop] Top of loop. Current queue size: 3
[DEBUG] Initial eventList snapshot (Size: 3):
  - 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir/move_this_dir
  - 2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir
  - 2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir
[DEBUG] Loop Start: Popped action: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir/move_this_dir, Sig=0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir/move_this_dir
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir/move_this_dir] Entering Create handler
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir/move_this_dir] os.Stat successful.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir/move_this_dir] Path /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir/move_this_dir got info: Id: 62372159, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir/move_this_dir, Mode: 20000000755
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir/move_this_dir] Entering Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir/move_this_dir] Checking potential RENAME partner: 2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir
Watchmap size: 3
/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir Id: 62372158, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir, Mode: 20000000755
/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir Id: 62372159, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir, Mode: 20000000755
/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir/move_this_dir Id: 62372159, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir/move_this_dir, Mode: 20000000755
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir/move_this_dir] Info for potential old path /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir from watchmap: Id: 62372159, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir, Mode: 20000000755
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir/move_this_dir] Comparing IDs: potentialRename.Id (62372159) == info.Id (62372159) -> true
[DEBUG - Create] Found RENAME partner 2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir for CREATE 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir/move_this_dir via ID match (62372159). Synthesizing.
[DEBUG - Create] Emitting synthesized RENAME: &{2 /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir/move_this_dir 2025-04-27 14:10:37.558572 +0300 EEST m=+9.761148334 map[Id:62372159 ModTime:2025-04-27 14:10:37.157858407 +0300 EEST Mode:2147484141 OldPath:/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir Size:64]}
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir/move_this_dir] Updating watchmap: Deleting /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir, Setting /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir/move_this_dir
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir/move_this_dir] Exited Rename check block. isRenameOrMove=true
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir/move_this_dir] Exiting Create handler.
[DEBUG] Loop Start: Popped action: Type=Rename, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir, Sig=2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir
[DEBUG] Loop Skip: Action 2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir already processed.
[DEBUG] Loop Start: Popped action: Type=Rename, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir, Sig=2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir
[DEBUG] Loop Skip: Action 2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir already processed.
[DEBUG] Loop End: Final processed paths: map[0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir/move_this_dir:true 2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir:true]
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:407: Received expected event: Type=2, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/parent_dir/move_this_dir, Props=map[Id:62372159 ModTime:2025-04-27 14:10:37.157858407 +0300 EEST Mode:2147484141 OldPath:/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3359364915/watch/move_this_dir Size:64]
=== RUN   TestFSBrokerIntegration/MoveDirectoryUnwatchedToWatched
[DEBUG - eventloop] Top of loop. Current queue size: 0
FSNotify Event: CREATE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1107779887/watch/external_dir
[DEBUG - addEvent] Received fsnotify event: Op=CREATE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1107779887/watch/external_dir
[DEBUG - addEvent]   -> Mapped to EventType: Create
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1107779887/watch/external_dir] Create event detected. Attempting immediate stat & map update.
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1107779887/watch/external_dir] Immediate os.Stat successful. Watchmap updated with ID 62372165.
[DEBUG - addEvent] Queuing event: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1107779887/watch/external_dir
[DEBUG - eventloop] Top of loop. Current queue size: 1
[DEBUG] Initial eventList snapshot (Size: 1):
  - 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1107779887/watch/external_dir
[DEBUG] Loop Start: Popped action: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1107779887/watch/external_dir, Sig=0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1107779887/watch/external_dir
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1107779887/watch/external_dir] Entering Create handler
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1107779887/watch/external_dir] os.Stat successful.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1107779887/watch/external_dir] Path /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1107779887/watch/external_dir got info: Id: 62372165, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1107779887/watch/external_dir, Mode: 20000000755
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1107779887/watch/external_dir] Entering Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1107779887/watch/external_dir] Exited Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1107779887/watch/external_dir] Processing as normal Create (not rename/move). isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1107779887/watch/external_dir] Emitting final CREATE event: &{0 /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1107779887/watch/external_dir 2025-04-27 14:10:38.164121 +0300 EEST m=+10.366695376 map[]}
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1107779887/watch/external_dir] Exiting Create handler.
[DEBUG] Loop End: Final processed paths: map[0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1107779887/watch/external_dir:true]
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:430: Received expected event: Type=0, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1107779887/watch/external_dir, Props=map[Id:62372165 ModTime:2025-04-27 14:10:38.162799059 +0300 EEST Mode:2147484141 Size:64]
=== RUN   TestFSBrokerIntegration/MoveDirectoryWatchedToUnwatched
[DEBUG - eventloop] Top of loop. Current queue size: 0
FSNotify Event: CREATE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir
[DEBUG - addEvent] Received fsnotify event: Op=CREATE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir
[DEBUG - addEvent]   -> Mapped to EventType: Create
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir] Create event detected. Attempting immediate stat & map update.
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir] Immediate os.Stat successful. Watchmap updated with ID 62372168.
[DEBUG - addEvent] Queuing event: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir
[DEBUG - eventloop] Top of loop. Current queue size: 1
[DEBUG] Initial eventList snapshot (Size: 1):
  - 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir
[DEBUG] Loop Start: Popped action: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir, Sig=0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir] Entering Create handler
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir] os.Stat successful.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir] Path /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir got info: Id: 62372168, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir, Mode: 20000000755
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir] Entering Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir] Exited Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir] Processing as normal Create (not rename/move). isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir] Emitting final CREATE event: &{0 /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir 2025-04-27 14:10:38.668793 +0300 EEST m=+10.871365876 map[]}
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir] Exiting Create handler.
[DEBUG] Loop End: Final processed paths: map[0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir:true]
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:444: Received expected event: Type=0, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir, Props=map[Id:62372168 ModTime:2025-04-27 14:10:38.668123413 +0300 EEST Mode:2147484141 Size:64]
FSNotify Event: RENAME, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir
[DEBUG - addEvent] Received fsnotify event: Op=RENAME, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir
[DEBUG - addEvent]   -> Mapped to EventType: Rename
[DEBUG - addEvent] Queuing event: Type=Rename, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir
[DEBUG - eventloop] Top of loop. Current queue size: 1
[DEBUG] Initial eventList snapshot (Size: 1):
  - 2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir
[DEBUG] Loop Start: Popped action: Type=Rename, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir, Sig=2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir
[DEBUG - Rename 2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir] Processing. Dumping watchmap BEFORE Get:
Watchmap size: 1
/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir Id: 62372168, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir, Mode: 20000000755
[DEBUG - Rename] No CREATE partner found for RENAME 2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir. Synthesizing Remove.
[DEBUG - Rename 2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir] Watchmap state before potential delete of /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir:
Watchmap size: 1
/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir Id: 62372168, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir, Mode: 20000000755
[DEBUG - Rename] Emitting synthesized REMOVE: &{3 /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir 2025-04-27 14:10:38.967702 +0300 EEST m=+11.170273959 map[Id:62372168 ModTime:2025-04-27 14:10:38.668123413 +0300 EEST Mode:2147484141 Size:64 Type:Soft]}
[DEBUG] Loop End: Final processed paths: map[2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir:true]
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:451: Received expected event: Type=3, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1244816268/watch/internal_dir, Props=map[Id:62372168 ModTime:2025-04-27 14:10:38.668123413 +0300 EEST Mode:2147484141 Size:64 Type:Soft]
=== RUN   TestFSBrokerIntegration/HardDeleteDirectory
[DEBUG - eventloop] Top of loop. Current queue size: 0
FSNotify Event: CREATE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1112361457/watch/delete_this_dir
[DEBUG - addEvent] Received fsnotify event: Op=CREATE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1112361457/watch/delete_this_dir
[DEBUG - addEvent]   -> Mapped to EventType: Create
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1112361457/watch/delete_this_dir] Create event detected. Attempting immediate stat & map update.
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1112361457/watch/delete_this_dir] Immediate os.Stat successful. Watchmap updated with ID 62372580.
[DEBUG - addEvent] Queuing event: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1112361457/watch/delete_this_dir
[DEBUG - eventloop] Top of loop. Current queue size: 1
[DEBUG] Initial eventList snapshot (Size: 1):
  - 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1112361457/watch/delete_this_dir
[DEBUG] Loop Start: Popped action: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1112361457/watch/delete_this_dir, Sig=0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1112361457/watch/delete_this_dir
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1112361457/watch/delete_this_dir] Entering Create handler
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1112361457/watch/delete_this_dir] os.Stat successful.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1112361457/watch/delete_this_dir] Path /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1112361457/watch/delete_this_dir got info: Id: 62372580, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1112361457/watch/delete_this_dir, Mode: 20000000755
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1112361457/watch/delete_this_dir] Entering Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1112361457/watch/delete_this_dir] Exited Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1112361457/watch/delete_this_dir] Processing as normal Create (not rename/move). isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1112361457/watch/delete_this_dir] Emitting final CREATE event: &{0 /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1112361457/watch/delete_this_dir 2025-04-27 14:10:39.572042 +0300 EEST m=+11.774612251 map[]}
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1112361457/watch/delete_this_dir] Exiting Create handler.
[DEBUG] Loop End: Final processed paths: map[0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1112361457/watch/delete_this_dir:true]
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:470: Received expected event: Type=0, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1112361457/watch/delete_this_dir, Props=map[Id:62372580 ModTime:2025-04-27 14:10:39.571811502 +0300 EEST Mode:2147484141 Size:96]
FSNotify Event: REMOVE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1112361457/watch/delete_this_dir/inner_file.txt
[DEBUG - addEvent] Received fsnotify event: Op=REMOVE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1112361457/watch/delete_this_dir/inner_file.txt
[DEBUG - addEvent]   -> Mapped to EventType: Remove
[DEBUG - addEvent] Queuing event: Type=Remove, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1112361457/watch/delete_this_dir/inner_file.txt
[DEBUG - eventloop] Top of loop. Current queue size: 1
    fsbroker_test.go:480: Waiting for first Remove event after RemoveAll(/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1112361457/watch/delete_this_dir)
FSNotify Event: REMOVE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1112361457/watch/delete_this_dir
[DEBUG - addEvent] Received fsnotify event: Op=REMOVE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1112361457/watch/delete_this_dir
[DEBUG - addEvent]   -> Mapped to EventType: Remove
[DEBUG - addEvent] Queuing event: Type=Remove, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1112361457/watch/delete_this_dir
[DEBUG - eventloop] Top of loop. Current queue size: 2
[DEBUG] Initial eventList snapshot (Size: 2):
  - 3-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1112361457/watch/delete_this_dir/inner_file.txt
  - 3-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1112361457/watch/delete_this_dir
[DEBUG] Loop Start: Popped action: Type=Remove, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1112361457/watch/delete_this_dir/inner_file.txt, Sig=3-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1112361457/watch/delete_this_dir/inner_file.txt
[DEBUG] Loop Start: Popped action: Type=Remove, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1112361457/watch/delete_this_dir, Sig=3-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1112361457/watch/delete_this_dir
    fsbroker_test.go:488: Received first remove event: Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1112361457/watch/delete_this_dir/inner_file.txt
    fsbroker_test.go:503: Received Remove event path 'delete_this_dir/inner_file.txt' matches expected paths ('delete_this_dir' or 'delete_this_dir/inner_file.txt')
    fsbroker_test.go:508: Draining potential subsequent Remove event...
[DEBUG] Loop End: Final processed paths: map[3-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1112361457/watch/delete_this_dir:true 3-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_1112361457/watch/delete_this_dir/inner_file.txt:true]
[DEBUG - eventloop] Top of loop. Current queue size: 0
[DEBUG] Initial eventList snapshot (Size: 0):
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:513: Checking for further unexpected events...
[DEBUG] Initial eventList snapshot (Size: 0):
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:514: Correctly received no event or error within 200ms
=== RUN   TestFSBrokerIntegration/IgnoreHiddenFile
[DEBUG - eventloop] Top of loop. Current queue size: 0
FSNotify Event: CREATE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3414875731/watch/.hidden_external
[DEBUG - addEvent] Received fsnotify event: Op=CREATE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3414875731/watch/.hidden_external
[DEBUG - addEvent]   -> Mapped to EventType: Create
[DEBUG - addEvent]   -> Ignored: Hidden file
[DEBUG] Initial eventList snapshot (Size: 0):
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:550: Correctly received no event or error within 600ms
=== RUN   TestFSBrokerIntegration/IgnoreSystemFile
[DEBUG - eventloop] Top of loop. Current queue size: 0
FSNotify Event: CREATE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_596490033/watch/.DS_Store
[DEBUG - addEvent] Received fsnotify event: Op=CREATE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_596490033/watch/.DS_Store
[DEBUG - addEvent]   -> Ignored: System file
[DEBUG] Initial eventList snapshot (Size: 0):
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:579: Correctly received no event or error within 600ms
=== RUN   TestFSBrokerIntegration/WriteDeduplication
[DEBUG - eventloop] Top of loop. Current queue size: 0
FSNotify Event: CREATE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt
[DEBUG - addEvent] Received fsnotify event: Op=CREATE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt
[DEBUG - addEvent]   -> Mapped to EventType: Create
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt] Create event detected. Attempting immediate stat & map update.
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt] Immediate os.Stat successful. Watchmap updated with ID 62372590.
[DEBUG - addEvent] Queuing event: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt
[DEBUG - eventloop] Top of loop. Current queue size: 1
[DEBUG] Initial eventList snapshot (Size: 1):
  - 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt
[DEBUG] Loop Start: Popped action: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt, Sig=0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt] Entering Create handler
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt] os.Stat successful.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt] Path /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt got info: Id: 62372590, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt, Mode: 644
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt] Entering Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt] Exited Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt] Processing as normal Create (not rename/move). isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt] Entering Write partner check block.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt] Exited Write partner check block. foundWritePartner=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt] No write partner found, emitting CREATE.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt] Emitting final CREATE event: &{0 /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt 2025-04-27 14:10:42.895082 +0300 EEST m=+15.097641542 map[]}
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt] Exiting Create handler.
[DEBUG] Loop End: Final processed paths: map[0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt:true]
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:595: Received expected event: Type=0, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt, Props=map[Id:62372590 ModTime:2025-04-27 14:10:42.894897493 +0300 EEST Mode:420 Size:5]
    fsbroker_test.go:598: Performing rapid writes...
FSNotify Event: WRITE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt
[DEBUG - addEvent] Received fsnotify event: Op=WRITE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt
[DEBUG - addEvent]   -> Mapped to EventType: Write
[DEBUG - addEvent] Queuing event: Type=Write, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt
[DEBUG - eventloop] Top of loop. Current queue size: 1
FSNotify Event: WRITE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt
[DEBUG - addEvent] Received fsnotify event: Op=WRITE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt
[DEBUG - addEvent]   -> Mapped to EventType: Write
[DEBUG - addEvent] Queuing event: Type=Write, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt
[DEBUG - eventloop] Top of loop. Current queue size: 2
FSNotify Event: WRITE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt
[DEBUG - addEvent] Received fsnotify event: Op=WRITE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt
[DEBUG - addEvent]   -> Mapped to EventType: Write
[DEBUG - addEvent] Queuing event: Type=Write, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt
[DEBUG - eventloop] Top of loop. Current queue size: 3
FSNotify Event: WRITE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt
[DEBUG - addEvent] Received fsnotify event: Op=WRITE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt
[DEBUG - addEvent]   -> Mapped to EventType: Write
[DEBUG - addEvent] Queuing event: Type=Write, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt
[DEBUG - eventloop] Top of loop. Current queue size: 4
FSNotify Event: WRITE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt
[DEBUG - addEvent] Received fsnotify event: Op=WRITE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt
[DEBUG - addEvent]   -> Mapped to EventType: Write
[DEBUG - addEvent] Queuing event: Type=Write, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt
[DEBUG - eventloop] Top of loop. Current queue size: 5
    fsbroker_test.go:612: Finished rapid writes.
[DEBUG] Initial eventList snapshot (Size: 5):
  - 1-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt
  - 1-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt
  - 1-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt
  - 1-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt
  - 1-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt
[DEBUG] Loop Start: Popped action: Type=Write, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt, Sig=1-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt
[DEBUG - Write] No preceding Create found or Create already processed. Emitting WRITE event: &{1 /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt 2025-04-27 14:10:43.400112 +0300 EEST m=+15.602670126 map[]}
[DEBUG - Write 1-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt] Watchmap state before Set/Enrich/Emit:
Watchmap size: 1
/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt Id: 62372590, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt, Mode: 644
[DEBUG] Loop Start: Popped action: Type=Write, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt, Sig=1-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt
[DEBUG] Loop Skip: Action 1-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt already processed.
[DEBUG] Loop Start: Popped action: Type=Write, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt, Sig=1-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt
[DEBUG] Loop Skip: Action 1-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt already processed.
[DEBUG] Loop Start: Popped action: Type=Write, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt, Sig=1-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt
[DEBUG] Loop Skip: Action 1-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt already processed.
[DEBUG] Loop Start: Popped action: Type=Write, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt, Sig=1-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt
[DEBUG] Loop Skip: Action 1-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt already processed.
[DEBUG] Loop End: Final processed paths: map[1-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt:true]
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:615: Received expected event: Type=1, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2701348581/watch/dedup_write.txt, Props=map[Id:62372590 ModTime:2025-04-27 14:10:43.400019931 +0300 EEST Mode:420 Size:45]
[DEBUG] Initial eventList snapshot (Size: 0):
[DEBUG - eventloop] Top of loop. Current queue size: 0
[DEBUG] Initial eventList snapshot (Size: 0):
[DEBUG - eventloop] Top of loop. Current queue size: 0
[DEBUG] Initial eventList snapshot (Size: 0):
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:618: Correctly received no event or error within 1.5s
=== RUN   TestFSBrokerIntegration/DeleteDeduplication
[DEBUG - eventloop] Top of loop. Current queue size: 0
FSNotify Event: CREATE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt
[DEBUG - addEvent] Received fsnotify event: Op=CREATE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt
[DEBUG - addEvent]   -> Mapped to EventType: Create
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt] Create event detected. Attempting immediate stat & map update.
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt] Immediate os.Stat successful. Watchmap updated with ID 62372593.
[DEBUG - addEvent] Queuing event: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt
[DEBUG - eventloop] Top of loop. Current queue size: 1
[DEBUG] Initial eventList snapshot (Size: 1):
  - 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt
[DEBUG] Loop Start: Popped action: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt, Sig=0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt] Entering Create handler
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt] os.Stat successful.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt] Path /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt got info: Id: 62372593, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt, Mode: 644
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt] Entering Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt] Exited Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt] Processing as normal Create (not rename/move). isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt] Entering Write partner check block.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt] Exited Write partner check block. foundWritePartner=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt] No write partner found, emitting CREATE.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt] Emitting final CREATE event: &{0 /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt 2025-04-27 14:10:45.299386 +0300 EEST m=+17.501937959 map[]}
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt] Exiting Create handler.
[DEBUG] Loop End: Final processed paths: map[0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt:true]
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:634: Received expected event: Type=0, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt, Props=map[Id:62372593 ModTime:2025-04-27 14:10:45.299236889 +0300 EEST Mode:420 Size:13]
    fsbroker_test.go:637: Performing rapid write then delete...
FSNotify Event: WRITE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt
[DEBUG - addEvent] Received fsnotify event: Op=WRITE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt
[DEBUG - addEvent]   -> Mapped to EventType: Write
[DEBUG - addEvent] Queuing event: Type=Write, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt
[DEBUG - eventloop] Top of loop. Current queue size: 1
    fsbroker_test.go:653: Finished rapid write then delete.
FSNotify Event: REMOVE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt
[DEBUG - addEvent] Received fsnotify event: Op=REMOVE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt
[DEBUG - addEvent]   -> Mapped to EventType: Remove
[DEBUG - addEvent] Queuing event: Type=Remove, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt
[DEBUG - eventloop] Top of loop. Current queue size: 2
[DEBUG] Initial eventList snapshot (Size: 2):
  - 1-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt
  - 3-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt
[DEBUG] Loop Start: Popped action: Type=Write, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt, Sig=1-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt
[DEBUG] Loop Start: Popped action: Type=Remove, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt, Sig=3-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt
[DEBUG] Loop End: Final processed paths: map[1-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt:true 3-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt:true]
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:656: Received expected event: Type=3, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_3189545902/watch/dedup_delete.txt, Props=map[Type:Hard]
[DEBUG] Initial eventList snapshot (Size: 0):
[DEBUG - eventloop] Top of loop. Current queue size: 0
[DEBUG] Initial eventList snapshot (Size: 0):
[DEBUG - eventloop] Top of loop. Current queue size: 0
[DEBUG] Initial eventList snapshot (Size: 0):
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:659: Correctly received no event or error within 1.5s
=== RUN   TestFSBrokerIntegration/MixedRapidActions
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:675: Performing mixed rapid actions...
FSNotify Event: CREATE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a.txt
[DEBUG - addEvent] Received fsnotify event: Op=CREATE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a.txt
[DEBUG - addEvent]   -> Mapped to EventType: Create
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a.txt] Create event detected. Attempting immediate stat & map update.
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a.txt] Immediate os.Stat successful. Watchmap updated with ID 62372596.
[DEBUG - addEvent] Queuing event: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a.txt
[DEBUG - eventloop] Top of loop. Current queue size: 1
FSNotify Event: CREATE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt
[DEBUG - addEvent] Received fsnotify event: Op=CREATE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt
[DEBUG - addEvent]   -> Mapped to EventType: Create
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt] Create event detected. Attempting immediate stat & map update.
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt] Immediate os.Stat successful. Watchmap updated with ID 62372597.
[DEBUG - addEvent] Queuing event: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt
[DEBUG - eventloop] Top of loop. Current queue size: 2
FSNotify Event: CREATE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_c.txt
[DEBUG - addEvent] Received fsnotify event: Op=CREATE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_c.txt
[DEBUG - addEvent]   -> Mapped to EventType: Create
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_c.txt] Create event detected. Attempting immediate stat & map update.
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_c.txt] Immediate os.Stat successful. Watchmap updated with ID 62372598.
[DEBUG - addEvent] Queuing event: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_c.txt
[DEBUG - eventloop] Top of loop. Current queue size: 3
FSNotify Event: CREATE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a_renamed.txt
[DEBUG - addEvent] Received fsnotify event: Op=CREATE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a_renamed.txt
[DEBUG - addEvent]   -> Mapped to EventType: Create
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a_renamed.txt] Create event detected. Attempting immediate stat & map update.
[DEBUG - addEvent 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a_renamed.txt] Immediate os.Stat successful. Watchmap updated with ID 62372596.
[DEBUG - addEvent] Queuing event: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a_renamed.txt
FSNotify Event: RENAME, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a.txt
[DEBUG - addEvent] Received fsnotify event: Op=RENAME, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a.txt
[DEBUG - addEvent]   -> Mapped to EventType: Rename
[DEBUG - addEvent] Queuing event: Type=Rename, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a.txt
[DEBUG - eventloop] Top of loop. Current queue size: 4
[DEBUG - eventloop] Top of loop. Current queue size: 5
FSNotify Event: WRITE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt
[DEBUG - addEvent] Received fsnotify event: Op=WRITE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt
[DEBUG - addEvent]   -> Mapped to EventType: Write
[DEBUG - addEvent] Queuing event: Type=Write, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt
[DEBUG - eventloop] Top of loop. Current queue size: 6
FSNotify Event: REMOVE, File: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_c.txt
[DEBUG - addEvent] Received fsnotify event: Op=REMOVE, Name=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_c.txt
[DEBUG - addEvent]   -> Mapped to EventType: Remove
[DEBUG - addEvent] Queuing event: Type=Remove, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_c.txt
[DEBUG - eventloop] Top of loop. Current queue size: 7
    fsbroker_test.go:686: Finished mixed rapid actions.
    fsbroker_test.go:689: Collecting events...
[DEBUG] Initial eventList snapshot (Size: 7):
  - 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a.txt
  - 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt
  - 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_c.txt
  - 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a_renamed.txt
  - 2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a.txt
  - 1-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt
  - 3-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_c.txt
[DEBUG] Loop Start: Popped action: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a.txt, Sig=0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a.txt
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a.txt] Entering Create handler
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a.txt] os.Stat failed (NotExist), removing from watchmap and skipping.
[DEBUG] Loop Start: Popped action: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt, Sig=0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt] Entering Create handler
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt] os.Stat successful.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt] Path /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt got info: Id: 62372597, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt, Mode: 644
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt] Entering Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt] Checking potential RENAME partner: 2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a.txt
Watchmap size: 4
/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a.txt Id: 62372596, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a.txt, Mode: 644
/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt Id: 62372597, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt, Mode: 644
/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_c.txt Id: 62372598, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_c.txt, Mode: 644
/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a_renamed.txt Id: 62372596, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a_renamed.txt, Mode: 644
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt] Info for potential old path /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a.txt from watchmap: Id: 62372596, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a.txt, Mode: 644
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt] Comparing IDs: potentialRename.Id (62372596) == info.Id (62372597) -> false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt] Exited Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt] Processing as normal Create (not rename/move). isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt] Entering Write partner check block.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt] Found subsequent WRITE partner 1-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt. Marking WRITE processed.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt] Exited Write partner check block. foundWritePartner=true
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt] Found write partner, emitting CREATE anyway (current logic).
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt] Emitting final CREATE event: &{0 /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt 2025-04-27 14:10:47.714002 +0300 EEST m=+19.916546709 map[]}
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt] Exiting Create handler.
[DEBUG] Loop Start: Popped action: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_c.txt, Sig=0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_c.txt
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_c.txt] Entering Create handler
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_c.txt] os.Stat failed (NotExist), removing from watchmap and skipping.
[DEBUG] Loop Start: Popped action: Type=Create, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a_renamed.txt, Sig=0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a_renamed.txt
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a_renamed.txt] Entering Create handler
    fsbroker_test.go:696: Collected Event: Type=0, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt, OldPath=<nil>
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a_renamed.txt] os.Stat successful.
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a_renamed.txt] Path /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a_renamed.txt got info: Id: 62372596, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a_renamed.txt, Mode: 644
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a_renamed.txt] Entering Rename check block. isRenameOrMove=false
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a_renamed.txt] Checking potential RENAME partner: 2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a.txt
Watchmap size: 4
/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a.txt Id: 62372596, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a.txt, Mode: 644
/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt Id: 62372597, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt, Mode: 644
/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_c.txt Id: 62372598, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_c.txt, Mode: 644
/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a_renamed.txt Id: 62372596, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a_renamed.txt, Mode: 644
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a_renamed.txt] Info for potential old path /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a.txt from watchmap: Id: 62372596, Path: /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a.txt, Mode: 644
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a_renamed.txt] Comparing IDs: potentialRename.Id (62372596) == info.Id (62372596) -> true
[DEBUG - Create] Found RENAME partner 2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a.txt for CREATE 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a_renamed.txt via ID match (62372596). Synthesizing.
[DEBUG - Create] Emitting synthesized RENAME: &{2 /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a_renamed.txt 2025-04-27 14:10:47.736645 +0300 EEST m=+19.939189751 map[Id:62372596 ModTime:2025-04-27 14:10:47.702638243 +0300 EEST Mode:420 OldPath:/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a.txt Size:9]}
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a_renamed.txt] Updating watchmap: Deleting /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a.txt, Setting /var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a_renamed.txt
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a_renamed.txt] Exited Rename check block. isRenameOrMove=true
[DEBUG - Create 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a_renamed.txt] Exiting Create handler.
[DEBUG] Loop Start: Popped action: Type=Rename, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a.txt, Sig=2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a.txt
[DEBUG] Loop Skip: Action 2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a.txt already processed.
[DEBUG] Loop Start: Popped action: Type=Write, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt, Sig=1-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt
[DEBUG] Loop Skip: Action 1-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt already processed.
[DEBUG] Loop Start: Popped action: Type=Remove, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_c.txt, Sig=3-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_c.txt
    fsbroker_test.go:696: Collected Event: Type=2, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a_renamed.txt, OldPath=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a.txt
    fsbroker_test.go:696: Collected Event: Type=3, Path=/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_c.txt, OldPath=<nil>
[DEBUG] Loop End: Final processed paths: map[0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a.txt:true 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a_renamed.txt:true 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt:true 0-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_c.txt:true 1-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_b.txt:true 2-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_a.txt:true 3-/var/folders/5z/yys8by895g3gnzwdv4p3syt40000gn/T/fsbroker_test_2729714622/watch/file_c.txt:true]
[DEBUG - eventloop] Top of loop. Current queue size: 0
[DEBUG] Initial eventList snapshot (Size: 0):
[DEBUG - eventloop] Top of loop. Current queue size: 0
[DEBUG] Initial eventList snapshot (Size: 0):
[DEBUG - eventloop] Top of loop. Current queue size: 0
[DEBUG] Initial eventList snapshot (Size: 0):
[DEBUG - eventloop] Top of loop. Current queue size: 0
[DEBUG] Initial eventList snapshot (Size: 0):
[DEBUG - eventloop] Top of loop. Current queue size: 0
    fsbroker_test.go:706: Finished collecting events. Got 3 events.
--- PASS: TestFSBrokerIntegration (22.07s)
    --- PASS: TestFSBrokerIntegration/CreateEmptyFile (0.50s)
    --- PASS: TestFSBrokerIntegration/CreateNonEmptyFile (0.71s)
    --- PASS: TestFSBrokerIntegration/ModifyFile (0.91s)
    --- PASS: TestFSBrokerIntegration/ClearFile (0.90s)
    --- PASS: TestFSBrokerIntegration/RenameFileInplace (0.90s)
    --- PASS: TestFSBrokerIntegration/MoveFileWatchedToWatched (1.30s)
    --- PASS: TestFSBrokerIntegration/MoveFileUnwatchedToWatched (0.50s)
    --- PASS: TestFSBrokerIntegration/MoveFileWatchedToUnwatched (0.90s)
    --- PASS: TestFSBrokerIntegration/HardDeleteFile (0.90s)
    --- PASS: TestFSBrokerIntegration/CreateDirectory (0.51s)
    --- PASS: TestFSBrokerIntegration/RenameDirectoryInplace (0.91s)
    --- PASS: TestFSBrokerIntegration/MoveDirectoryWatchedToWatched (1.31s)
    --- PASS: TestFSBrokerIntegration/MoveDirectoryUnwatchedToWatched (0.51s)
    --- PASS: TestFSBrokerIntegration/MoveDirectoryWatchedToUnwatched (0.90s)
    --- PASS: TestFSBrokerIntegration/HardDeleteDirectory (1.71s)
    --- PASS: TestFSBrokerIntegration/IgnoreHiddenFile (0.81s)
    --- PASS: TestFSBrokerIntegration/IgnoreSystemFile (0.81s)
    --- PASS: TestFSBrokerIntegration/WriteDeduplication (2.41s)
    --- PASS: TestFSBrokerIntegration/DeleteDeduplication (2.40s)
    --- PASS: TestFSBrokerIntegration/MixedRapidActions (2.27s)
PASS
ok  	github.com/helshabini/fsbroker	22.512s
